Interviewer: "How does traffic flow between VPCs through Transit Gateway?"

Your answer: "Traffic flows logically from EC2 instance to EC2 instance, but the actual
path traverses through dedicated Transit Gateway subnets in each VPC. AWS places ENIs in
these TGW subnets, and the VPC route tables direct inter-VPC traffic to the Transit
Gateway attachment. The packet physically travels from the source workload subnet,
through the source VPC's TGW subnet ENI, into the Transit Gateway hub, then out
through the destination VPC's TGW subnet ENI, and finally to the destination workload
subnet. This architecture provides high availability since we have TGW subnets in multiple AZs."

# Lab VPC Attachment
lab_attachment = tgw.create_transit_gateway_vpc_attachment(
    name="lab-tgw-attachment",
    transit_gateway_id=transit_gateway.id,
    vpc_id=lab_vpc.id,
    subnet_ids=[
        lab_tgw_subnet_a.id,  # In us-east-1a
        lab_tgw_subnet_b.id,  # In us-east-1b
    ]
)
```

---

## ğŸŒ **What AWS Creates**

### **Behind the Scenes:**

When you attach a VPC to Transit Gateway:

1. **AWS creates ENIs (Elastic Network Interfaces):**
   - 1 ENI in TGW Subnet A (us-east-1a)
   - 1 ENI in TGW Subnet B (us-east-1b)

2. **These ENIs are the "connection points":**
   - Traffic from Lab VPC â†’ ENI in TGW Subnet A â†’ Transit Gateway
   - Or Traffic from Lab VPC â†’ ENI in TGW Subnet B â†’ Transit Gateway

3. **High Availability:**
   - If AZ-A fails, traffic routes through AZ-B
   - Both ENIs are always active (not active/standby)

---

## ğŸ“Š **Visual Representation**

### **Physical Layout:**
```
                    Transit Gateway (Regional Service)
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
   [us-east-1a]        [us-east-1b]        [us-east-1c]
        â”‚                   â”‚
        â”‚                   â”‚
Lab VPC â”‚              Lab VPC â”‚
TGW Subnet A           TGW Subnet B
10.200.255.0/24        10.200.254.0/24
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Lab VPC
       10.200.0.0/16
```

### **Each VPC Has:**
```
Lab VPC:
  â”œâ”€â”€ Workload Subnet (10.200.10.0/24) â†’ us-east-1a
  â”œâ”€â”€ TGW Subnet A (10.200.255.0/24) â†’ us-east-1a â† ENI here
  â””â”€â”€ TGW Subnet B (10.200.254.0/24) â†’ us-east-1b â† ENI here

Dev VPC:
  â”œâ”€â”€ Workload Subnet (10.201.10.0/24) â†’ us-east-1a
  â”œâ”€â”€ TGW Subnet A (10.201.255.0/24) â†’ us-east-1a â† ENI here
  â””â”€â”€ TGW Subnet B (10.201.254.0/24) â†’ us-east-1b â† ENI here
```

---

## ğŸ¯ **The "Pair" Concept**

### **There Are Two Ways to Think About "Pairs":**

#### **Interpretation 1: Per-VPC Pair**

**Lab VPC has a PAIR of TGW subnets:**
- TGW Subnet A (AZ-A)
- TGW Subnet B (AZ-B)

**Dev VPC has a PAIR of TGW subnets:**
- TGW Subnet A (AZ-A)
- TGW Subnet B (AZ-B)

**This is correct!** Each VPC needs TGW subnets in multiple AZs for HA.

---

#### **Interpretation 2: Cross-VPC Pair** âŒ (Not What Happens)

**This would be WRONG:**
- Lab TGW Subnet A + Dev TGW Subnet A = "Pair in AZ-A"
- Lab TGW Subnet B + Dev TGW Subnet B = "Pair in AZ-B"

**Why wrong?** They're not paired with each other. Each VPC attachment is independent.

---

## ğŸ“ **Attachment Structure**

### **What Actually Exists:**
```
Transit Gateway (Regional)
    â”‚
    â”œâ”€â”€ Lab VPC Attachment
    â”‚   â”œâ”€â”€ ENI in Lab TGW Subnet A (us-east-1a)
    â”‚   â””â”€â”€ ENI in Lab TGW Subnet B (us-east-1b)
    â”‚
    â””â”€â”€ Dev VPC Attachment
        â”œâ”€â”€ ENI in Dev TGW Subnet A (us-east-1a)
        â””â”€â”€ ENI in Dev TGW Subnet B (us-east-1b)
```

**Key Point:** Each attachment is independent!

---

## ğŸ”„ **Traffic Flow Example**

### **When Lab Instance (10.200.10.4) pings Dev Instance (10.201.10.4):**

**Path 1 (via AZ-A):**
```
Lab Instance (10.200.10.4)
    â†“
Lab Workload Subnet (10.200.10.0/24) in us-east-1a
    â†“ (Route: 10.201.0.0/16 â†’ tgw-xxxxx)
Lab TGW Subnet A (10.200.255.0/24) in us-east-1a
    â†“ (ENI here)
Transit Gateway (regional service)
    â†“ (Route table: 10.201.0.0/16 â†’ dev-attachment)
Dev TGW Subnet A (10.201.255.0/24) in us-east-1a
    â†“ (ENI here)
Dev Workload Subnet (10.201.10.0/24) in us-east-1a
    â†“
Dev Instance (10.201.10.4)
```

**Path 2 (via AZ-B - if AZ-A fails):**
```
Lab Instance (10.200.10.4)
    â†“
Transit Gateway (uses ENI in Lab TGW Subnet B)
    â†“
Dev Instance (via ENI in Dev TGW Subnet B)
```

---

## ğŸ—ï¸ **Why This Architecture?**

### **High Availability:**

**Scenario 1: Normal Operation**
- Both AZs active
- AWS load balances across ENIs

**Scenario 2: AZ-A Fails**
- Lab TGW Subnet A (AZ-A) âŒ Down
- Lab TGW Subnet B (AZ-B) âœ… Still works
- Traffic automatically routes through AZ-B

**Scenario 3: AZ-B Fails**
- Lab TGW Subnet B (AZ-B) âŒ Down
- Lab TGW Subnet A (AZ-A) âœ… Still works
- Traffic automatically routes through AZ-A

**No single AZ failure breaks connectivity!** âœ…

---

## ğŸ“Š **Updated Diagram**

### **To Make AZ Placement Clearer:**

Add AZ labels to your diagram:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lab VPC                             â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Workload Subnet  â”‚  (us-east-1a) â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ TGW      â”‚ â”‚ TGW      â”‚          â”‚
â”‚  â”‚ Subnet A â”‚ â”‚ Subnet B â”‚          â”‚
â”‚  â”‚.255/24   â”‚ â”‚.254/24   â”‚          â”‚
â”‚  â”‚(AZ-A)    â”‚ â”‚(AZ-B)    â”‚ â† Add these!
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**This makes the multi-AZ architecture explicit!**

---

## âœ… **Summary:**

**Correct interpretation:**
- âœ… Lab VPC has 2 TGW subnets (one in AZ-A, one in AZ-B)
- âœ… Dev VPC has 2 TGW subnets (one in AZ-A, one in AZ-B)
- âœ… Each TGW subnet is in a different AZ (for HA)

**Architecture:**
```
Lab VPC TGW Subnet A (10.200.255.0/24) â†’ us-east-1a
Lab VPC TGW Subnet B (10.200.254.0/24) â†’ us-east-1b

Dev VPC TGW Subnet A (10.201.255.0/24) â†’ us-east-1a
Dev VPC TGW Subnet B (10.201.254.0/24) â†’ us-east-1b